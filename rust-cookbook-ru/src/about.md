# Немного о том, как "готовить" Rust

## Содержание

- [Для кого эта книга](#%D0%B4%D0%BB%D1%8F-%D0%BA%D0%BE%D0%B3%D0%BE-%D1%8D%D1%82%D0%B0-%D0%BA%D0%BD%D0%B8%D0%B3%D0%B0)
- [Как читать эту книгу](#%D0%BA%D0%B0%D0%BA-%D1%87%D0%B8%D1%82%D0%B0%D1%82%D1%8C-%D1%8D%D1%82%D1%83-%D0%BA%D0%BD%D0%B8%D0%B3%D1%83)
- [Как использовать рецепты](#%D0%BA%D0%B0%D0%BA-%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D1%8C%D1%81%D1%8F-%D1%80%D0%B5%D1%86%D0%B5%D0%BF%D1%82%D0%B0%D0%BC%D0%B8)
- [Несколько слов об обработке ошибок](#%D0%B7%D0%B0%D0%BC%D0%B5%D1%82%D0%BA%D0%B0-%D0%BE%D0%B1-%D0%BE%D0%B1%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D0%BA%D0%B5-%D0%BE%D1%88%D0%B8%D0%B1%D0%BE%D0%BA)
- [Несколько слов о представлении крейтов](#%D0%B7%D0%B0%D0%BC%D0%B5%D1%82%D0%BA%D0%B0-%D0%BE-%D0%BF%D1%80%D0%B5%D0%B4%D1%81%D1%82%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B8-%D1%8F%D1%89%D0%B8%D0%BA%D0%B0)

## Для кого эта книга

Эта книга предназначена для новичков в Rust, таким образом они могут быстро получить обзор возможностей экосистемы выросшей вокруг Rust. Книга также предназначена и для опытных разработчиков на Rust, которым иногда требуется взглянуть в рецепт, чтобы быстро вспомнить, как сделать какую-то обычную задачу, возникшую на практике.

## Как читать эту книгу

Книга содержит [указатель] всех рецептов, организованных в разделы: "основы", "кодирование данных", "конкуррентность" и так далее. Сами по себе разделы более или менее упорядочены по сложности, более поздние разделы обычно требуют подготовки, и иногда требуют понимания материала, встречающегося в предыдущих разделах.

В указателе каждый раздел содержит список рецептов. Рецепты представляют собой постановку задачи, например "сгенерировать случайные числа из диапазона"; и каждый рецепт помечен "шильдиками", показывающими какие *крейты* они используют (*крейты* (crates) - так называются библиотеки в экосистеме Rust), например [![rand-badge]][rand], а также к каким категориям в [crates.io] эти крейты принадлежат, например [![cat-science-badge]][cat-science].

Новичкам скорее всего будет комфортно читать последовательно с первого раздела до последнего и такое чтение даст хорошее представление об экосистеме. Кликайте на заголовок раздела в указателе или на боковой панели, чтобы перейти прямо к нужному разделу в книге.

Если вы просто ищете решение для какой-то простой задачи, эта книга на данный момент более трудна для такого поиска. Самый простой путь чтобы найти нужный рецепт - это просмотреть указатель на предмет нужных крейтов и категорий, которые вас интересуют. И там уже кликайте на название рецепта, чтобы посмотреть его полностью. Эту неэффективность мы исправим в будущем.

## Как использовать рецепты

Рецепты построены так, чтобы дать вам мгновенный доступ к работающему коду наряду с полным объяснением, как он работает и дать вам пути, для получения дальнейшей информации по этой теме.

Все рецепты в этом сборнике являются полными, самодостаточными программами и могут быть скопированы прямо в ваш проект для дальнейших экспериментов с ними. Чтобы сделать это следуйте инструкциям ниже.

Рассмотрим пример "сгенерировать случайные числа из диапазона":

[![rand-badge]][rand] [![cat-science-badge]][cat-science]

```rust
extern crate rand;
use rand::Rng;

fn main() {
    let mut rng = rand::thread_rng();
    println!("Random f64: {}", rng.gen::<f64>());
}
```

Чтобы "поиграться" с ним локально нам нужно запустить следующие команды для создания нового cargo-проекта (cargo - это пакетный менеджер для Rust) и перейти внутрь только что созданного проекта:

```sh
cargo new my-example --bin
cd my-example
```

Теперь вам также нужно добавить все необходимые крейты в файл [Cargo.toml], как показано в "шильдиках", в данном случае просто rand. Чтобы это сделать, используйте команду `cargo add`, которая реализована в крейте [`cargo-edit`] и вам его нужно сначала установить:

```sh
cargo install cargo-edit
cargo add rand
```

Теперь вы можете заменить содержимое файла `src/main.rs` на полностью скопированное из рецепта и запустить этот код:

```sh
cargo run
```

Шильдики крейтов, которые сопровождают примеры кода также содержат ссылки на документацию по соответствующим крестам на сайте [docs.rs], и часто на дополнительную документацию по тем крестам, которые могут быть вам полезны и возможно подходят вам для решения вашей задачи.

## Несколько слов об обработке ошибок

Обработка ошибок в Rust железобетонна, если её использовать правильно, но в настоящее время Rust требует некоторое количество "механического" шаблонного кода (boilerplate). Из-за этого примеры на Rust часто содержат вызовы `unwrap` вместо правильной обработки ошибок.

Поскольку эти рецепты предназначены использоваться как есть и внедрить наилучшие практики, они также сделаны таким образом, чтобы обеспечить правильную обработку ошибок. "Правильную" в том числе и в случаях, когда появляются типы `Option` и `Result`.

Основной шаблон - это использовать главную функцию `fn main() -> Result`.

Обычно структура примеров выглядит как-то так:

```rust
#[macro_use]
extern crate error_chain;

use std::net::IpAddr;
use std::str;

error_chain! {
    foreign_links {
        Utf8(std::str::Utf8Error);
        AddrParse(std::net::AddrParseError);
    }
}

fn main() -> Result<()> {
    let bytes = b"2001:db8::1";

    // Bytes to string.
    let s = str::from_utf8(bytes)?;

    // String to IP address.
    let addr: IpAddr = s.parse()?;

    println!("{:?}", addr);
    Ok(())
}
```

Этот пример использует макрос `error_chain!` чтобы определить пользовательские типы `Error` и
`Result`, наряду с автоматическими преобразованиями для типов ошибок из стандартной библиотеки. Такие автоматические преобразования позволят работать оператору `?`.

Для целей повышения читаемости механический код связанный с обработкой ошибок по-умолчанию скрыт. Чтобы посмотреть полное содержимое примера, кликайте на кнопку "expand" (<i class="fa fa-expand">), помещённую в верхнем левом углу фрагмента кода.</i>

```rust
# #[macro_use]
# extern crate error_chain;
extern crate url;

use url::{Url, Position};
#
# error_chain! {
#     foreign_links {
#         UrlParse(url::ParseError);
#     }
# }

fn main() -> Result<()> {
    let parsed = Url::parse("https://httpbin.org/cookies/set?k2=v2&k1=v1")?;
    let cleaned: &str = &parsed[..Position::AfterPath];
    println!("cleaned: {}", cleaned);
    Ok(())
}
```

Для более глубокого изучения обработки ошибок в Rust, читайте [эту главу в Растбуке], [этот блог пост], (и документацию по крейту https://docs.rs/snafu/0.1.4/snafu/ - прим. перев.)

## Несколько слов о представлении крейтов

Эта книга предназначена в конечном итоге дать полноценное покрытие экосистемы вокруг Rust, но на сегодняшний день книга ограничена в охвате, пока мы работаем над инструментами и способом подачи материала книги. Надеемся, начав с малого охвата и постепенно расширяясь книга скоро станет источником высокого качества и будет поддерживать высокий стандарт качества по мере наполнения.

В настоящий момент книга _Rust. Сборник рецептов_ в-основном сосредоточена на стандартной библиотеке, и на "центральных" или "основных" крейтах - эти крейты обеспечивают выполнение самых распространённых программистских задач, и остальная часть экосистемы выстроена на этой основе.

Эта книга очень близко связана с [Rust Libz Blitz], проектом, чтобы собрать информацию о библиотеках и улучшить их качество и книга оставляет "привилегию" выбора за этим проектом. Любой крейт, упомянутый в книге уже прошёл проверку в рамках этого проекта, но также есть и крейты ожидающие такой проверки.

{{#include links.md}}


[указатель]: intro.html
[эту главу в Растбуке]: https://doc.rust-lang.org/book/error-handling.html
[этот блог пост]: https://brson.github.io/2016/11/30/starting-with-error-chain
[Rust Libz Blitz]: https://docs.rs/error-chain/
[crates.io]: https://internals.rust-lang.org/t/rust-libz-blitz/5184
[docs.rs]: https://crates.io
[Cargo.toml]: https://docs.rs
[`cargo-edit`]: http://doc.crates.io/manifest.html